
## Overview

In the Mailscript Pipeline, E-Mail messages are parsed into a custom JSON object. This object contains a wealth of metadata based on each message and other useful bits of information like [Integrations](/cli/integrations). To access this data, Mailscript Actions' `body` and `text` tags are parsed with HandleBars, providing a method of Variable Interpolation and, thus, allowing you to substitute text in for processed metadata. For more in-depth documentaion on HandlBars, read up on it [here](https://handlebarsjs.com/guide/).

### HandleBars Example

```
My variable is {{variable}}
```

Assuming the variable is defined as "did you receive my email?", the processed output would look like: 
```
My variable is did you receive my email?
```

## Available Metadata

There are many data fields generated by the Mailscript Pipeline for each E-Mail message. These fields can be used in the `body` or `text` section of a Mailscript Action in your Mailscript Workflow. The data fields will be available regardless of the type of the Action. Additional data fields may be supplied depending on the contents of the E-Mail message and the type of the Action. See the [Examplea](#examples) section for usage.

### Subset of Metadata Fields

| Name      | Description |
| ----------- | ----------- |
| `msg.text`      | Body of the text-only email |
| `msg.html`      | Body of the HTML-formatted email |
| `msg.subject`   | Subject line of the email |
| `msg.attachments`   | List of attachments in the email |

## Extended HandleBars Functionality

Some extra functionality has been added to HandleBars. This includes a special data field (`all`) and a Regular Expression matcher.

### `all` Data Field

The `all` data field returns the entirety of the JSON object created by the Mailscript Pipeline. 

### Regular Expression Matcher

The Regular Expression matcher is used on a data field to check if some formatted text is present or to collect dynamic data from an E-Mail message such as a time, date, or price. The syntax for the matcher is defined as follows:

```
{{ match data-field regex regex-flags index-of-match }}
```

- match: the keyword to initiate the match
- data-field: the metadata field to run the Regular Expression on
- regex: the Regular Expression to run on the metadata field
- regex-flags: the flags to mask onto the Regular Expression
- index-of-match: the index of the match to choose (starting at 0)

## Examples

### YML Example

<img src="/images/var_example_yml.png"/>

This example was taken from the [annotated workflow example](https://github.com/mailscript/cli/blob/main/docs/docs/cli/annotated-workflow.yml)

### CLI Example
Or, if you are using the CLI:

Forwarding an email
```sh
mailscript actions:add --from=MyEmail@mailscript.com --forward=john@example.com --subject="{{msg.subject}}" --text="The body of the email is {{msg.text}}"
```

Sending a SMS message
Note: This will require you to verify the sms number used ahead of time or this will not be able to receive SMS messages upon execution of the action.
```sh
mailscript actions:add --sms=1235555000 --text "The body of the email is {{msg.text}}"
```
